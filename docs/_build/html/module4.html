

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Computing statistical power &mdash; Bioverse 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorial 1: Generating planetary systems" href="Notebooks/GettingStarted1.html" />
    <link rel="prev" title="Hypothesis testing" href="module3.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Bioverse
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="table.html">The <code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="module1.html">Simulated planetary systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="module2.html">Simulated survey datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="module3.html">Hypothesis testing</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Computing statistical power</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#parameter-grids">Parameter grids</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plotting-the-results">Plotting the results</a></li>
<li class="toctree-l2"><a class="reference internal" href="#multiprocessing">Multiprocessing</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/GettingStarted1.html">Tutorial 1: Generating planetary systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/GettingStarted2.html">Tutorial 2: Simulating survey datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Example1.html">Example 1: Finding the habitable zone</a></li>
<li class="toctree-l1"><a class="reference internal" href="Notebooks/Example2.html">Example 2: Detecting the age-oxygen correlation</a></li>
</ul>
<p class="caption"><span class="caption-text">Full Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.analysis.html">bioverse.analysis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.classes.html">bioverse.classes module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.constants.html">bioverse.constants module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.custom.html">bioverse.custom module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.functions.html">bioverse.functions module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.generator.html">bioverse.generator module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.hypothesis.html">bioverse.hypothesis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.plots.html">bioverse.plots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.survey.html">bioverse.survey module</a></li>
<li class="toctree-l1"><a class="reference internal" href="apidoc/bioverse.util.html">bioverse.util module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Bioverse</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Computing statistical power</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/module4.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="computing-statistical-power">
<h1>Computing statistical power<a class="headerlink" href="#computing-statistical-power" title="Permalink to this headline">¶</a></h1>
<p>Consider the “habitable zone hypothesis”, which proposes that habitable planets with atmospheric water vapor will be more common within the semi-major axis range <code class="docutils literal notranslate"><span class="pre">a_inner</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">a_eff</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">a_outer</span></code> (see Section 6 of the paper and Example 1 for more details). In <code class="docutils literal notranslate"><span class="pre">Bioverse</span></code>, this effect is injected into the simulated sample by the <code class="xref py py-func docutils literal notranslate"><span class="pre">Example1_water()</span></code> function, and tested using the <code class="docutils literal notranslate"><span class="pre">h_HZ</span></code> Hypothesis. To test this hypothesis using a LUVOIR-like direct imaging survey:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bioverse.generator</span> <span class="kn">import</span> <span class="n">Generator</span>
<span class="kn">from</span> <span class="nn">bioverse.survey</span> <span class="kn">import</span> <span class="n">ImagingSurvey</span>
<span class="kn">from</span> <span class="nn">bioverse.hypothesis</span> <span class="kn">import</span> <span class="n">h_HZ</span>

<span class="c1"># Load the Generator and Survey objects</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;imaging&#39;</span><span class="p">)</span>
<span class="n">survey</span> <span class="o">=</span> <span class="n">ImagingSurvey</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>

<span class="c1"># Generate a set of planetary systems and a simulated dataset as observed by an imaging survey</span>
<span class="c1"># Assume 50% of EECs are habitable (f_water_habitable=0.5)</span>
<span class="c1"># Assume 1% of non-habitable planets have water vapor (f_water_nonhabitable=0.01)</span>
<span class="n">sample</span><span class="p">,</span> <span class="n">detected</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">survey</span><span class="o">.</span><span class="n">quickrun</span><span class="p">(</span><span class="n">generator</span><span class="p">,</span> <span class="n">f_water_habitable</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">f_water_nonhabitable</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>

<span class="c1"># Test the habitable zone hypothesis from this dataset</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">h_HZ</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evidence in favor of the habitable zone hypothesis is </span><span class="si">{:.1f}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;dlnZ&#39;</span><span class="p">]))</span>
</pre></div>
</div>
<p>Output: <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">evidence</span> <span class="pre">in</span> <span class="pre">favor</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">habitable</span> <span class="pre">zone</span> <span class="pre">hypothesis</span> <span class="pre">is</span> <span class="pre">6.4.</span></code></p>
<p>This result corresponds to a “p-value” of ~1.7E-3. However, this represents only one possible realization of the survey. Due to Poisson uncertainty, another equivalent survey might detect fewer habitable planets and thus be less capable of testing the hypothesis. To capture this, we can repeat the survey several times and average their results. The <a class="reference internal" href="apidoc/bioverse.analysis.html#module-bioverse.analysis" title="bioverse.analysis"><code class="xref py py-mod docutils literal notranslate"><span class="pre">analysis</span></code></a> module enables this through its <a class="reference internal" href="apidoc/bioverse.analysis.html#bioverse.analysis.test_hypothesis_grid" title="bioverse.analysis.test_hypothesis_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">test_hypothesis_grid()</span></code></a> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bioverse</span> <span class="kn">import</span> <span class="n">analysis</span>

<span class="c1"># Repeat the hypothesis test N=30 times with the same assumptions as above</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">test_hypothesis_grid</span><span class="p">(</span><span class="n">h_HZ</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">survey</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">f_water_habitable</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                                        <span class="n">f_water_nonhabitable</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Determine the statistical power assuming a significance threshold of dlnZ &gt; 3</span>
<span class="n">power</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">compute_statistical_power</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;dlnZ&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The statistical power of the survey is </span><span class="si">{:.1f}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">power</span><span class="p">))</span>
</pre></div>
</div>
<p>Output: <code class="docutils literal notranslate"><span class="pre">The</span> <span class="pre">statistical</span> <span class="pre">power</span> <span class="pre">of</span> <span class="pre">the</span> <span class="pre">survey</span> <span class="pre">is</span> <span class="pre">75.0%.</span></code></p>
<p>Under the assumptions that 50% of exo-Earth candidates are habitable <strong>and</strong> 1% of non-habitable planets have H2O in their atmospheres, it is 75% likely that a LUVOIR-like survey would be able to detect the overabundance of H2O in the habitable zone.</p>
<div class="section" id="parameter-grids">
<h2>Parameter grids<a class="headerlink" href="#parameter-grids" title="Permalink to this headline">¶</a></h2>
<p>Of course, those assumptions are highly uncertain, and a more thorough analysis should investigate how this result depends on key model parameters - such as <code class="docutils literal notranslate"><span class="pre">f_water_habitable</span></code> or <code class="docutils literal notranslate"><span class="pre">eta_Earth</span></code>. This can be done by passing an array of values for these parameters to the <a class="reference internal" href="apidoc/bioverse.analysis.html#bioverse.analysis.test_hypothesis_grid" title="bioverse.analysis.test_hypothesis_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">test_hypothesis_grid()</span></code></a> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Vary the fraction of EECs with water vapor from 1% to 100% (log spacing)</span>
<span class="n">f_water_habitable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Vary eta Earth from 7.5% to 30% (linear spacing)</span>
<span class="n">eta_Earth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.075</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="c1"># Test the hypothesis N=30 times for each parameter combination</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">test_hypothesis_grid</span><span class="p">(</span><span class="n">h_HZ</span><span class="p">,</span> <span class="n">generator</span><span class="p">,</span> <span class="n">survey</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">f_water_habitable</span><span class="o">=</span><span class="n">f_water_habitable</span><span class="p">,</span>
                                        <span class="n">eta_Earth</span><span class="o">=</span><span class="n">eta_Earth</span><span class="p">,</span> <span class="n">f_water_nonhabitable</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">processes</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># Compute the statistical power for each parameter combination</span>
<span class="n">power</span> <span class="o">=</span> <span class="n">analysis</span><span class="o">.</span><span class="n">compute_statistical_power</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;dlnZ&#39;</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">power</span></code> will be a 5x5 array containing the statistical power for each parameter combination. The axis order depends on the order in which arguments are passed to <a class="reference internal" href="apidoc/bioverse.analysis.html#bioverse.analysis.test_hypothesis_grid" title="bioverse.analysis.test_hypothesis_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">test_hypothesis_grid()</span></code></a>; in this case, <code class="docutils literal notranslate"><span class="pre">f_water_habitable</span></code> will correspond to the first axis and <code class="docutils literal notranslate"><span class="pre">eta_Earth</span></code> to the second.</p>
</div>
<div class="section" id="plotting-the-results">
<h2>Plotting the results<a class="headerlink" href="#plotting-the-results" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="apidoc/bioverse.plots.html#bioverse.plots.plot_power_grid" title="bioverse.plots.plot_power_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">plot_power_grid()</span></code></a> function can be used to plot the statistical power over a 2-dimensional grid. Starting from the above example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bioverse.plots</span> <span class="kn">import</span> <span class="n">plot_power_grid</span>

<span class="c1"># Specify which parameters to plot on the x and y axes</span>
<span class="n">axes</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;f_water_habitable&#39;</span><span class="p">,</span> <span class="s1">&#39;eta_Earth&#39;</span><span class="p">)</span>

<span class="c1"># Set the axis labels</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Fraction of EECs that are habitable&#39;</span><span class="p">,</span> <span class="s1">&#39;eta Earth&#39;</span><span class="p">)</span>

<span class="c1"># Set log-scale for the x axis</span>
<span class="n">log</span> <span class="o">=</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">plot_power_grid</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">)</span>
</pre></div>
</div>
<img alt="_images/power_plot.png" src="_images/power_plot.png" />
<p>The number and percentage values of the contour lines can be set with the <code class="docutils literal notranslate"><span class="pre">levels</span></code> argument, or set <code class="docutils literal notranslate"><span class="pre">levels=None</span></code> to disable them. To create a higher resolution plot with smoother contour lines, simply run <a class="reference internal" href="apidoc/bioverse.analysis.html#bioverse.analysis.test_hypothesis_grid" title="bioverse.analysis.test_hypothesis_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">test_hypothesis_grid()</span></code></a> over a finer grid of parameter values.</p>
</div>
<div class="section" id="multiprocessing">
<h2>Multiprocessing<a class="headerlink" href="#multiprocessing" title="Permalink to this headline">¶</a></h2>
<p>To compute the statistical power for a 20x20 parameter grid with <code class="docutils literal notranslate"><span class="pre">N=50</span></code> simulations in each cell requires 20,000 simulations, or approximately 5-6 hours for the example above. Fortunately, these simulations are entirely independent of each other, making parallel processing an effective solution. You can use the <code class="docutils literal notranslate"><span class="pre">processes</span></code> argument of <a class="reference internal" href="apidoc/bioverse.analysis.html#bioverse.analysis.test_hypothesis_grid" title="bioverse.analysis.test_hypothesis_grid"><code class="xref py py-func docutils literal notranslate"><span class="pre">test_hypothesis_grid()</span></code></a> to indicate how many processes to run in parallel. Note that <code class="docutils literal notranslate"><span class="pre">Bioverse</span></code> can be memory-intensive, so large values of <code class="docutils literal notranslate"><span class="pre">processes</span></code> (e.g. greater than 10) can have diminishing returns or lead to a crash.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="Notebooks/GettingStarted1.html" class="btn btn-neutral float-right" title="Tutorial 1: Generating planetary systems" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="module3.html" class="btn btn-neutral float-left" title="Hypothesis testing" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Alex Bixel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
  
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search {
    display: block;
    width: 300px;
    padding: .809em;
    margin-bottom: .809em;
    z-index: 200;
    background-color: #0b750a;
    text-align: center;
    color: #fcfcfc;
    }
    .wy-nav-top {
      background: #0b750a;
    }
    
    .wy-menu-vertical header, .wy-menu-vertical p.caption {
    color: #0b750a;
    line-height: 32px;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 85%;
    white-space: nowrap;
}

html.writer-html4 .rst-content dl:not(.docutils) > dt, html.writer-html5 .rst-content dl[class]:not(.option-list):not(.field-list):not(.footnote):not(.glossary):not(.simple) > dt {
    display: table;
    margin: 6px 0;
        margin-top: 6px;
    font-size: 90%;
    line-height: normal;
    background: #edffed;
    color: #0b750a;
    border-top: 3px solid #0b750a;
    padding: 6px;
    position: relative;
}

  a {
    color: #0b750a;
    text-decoration: none;
    cursor: pointer;
}

.wy-table-responsive table td, .wy-table-responsive table th {
    white-space: normal;
}

  </style>
  
  
  


</body>
</html>