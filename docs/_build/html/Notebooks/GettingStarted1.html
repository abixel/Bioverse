

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Tutorial 1: Generating planetary systems &mdash; Bioverse 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial 2: Simulating survey datasets" href="GettingStarted2.html" />
    <link rel="prev" title="Computing statistical power" href="../module4.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Bioverse
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../overview.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../table.html">The <code class="xref py py-class docutils literal notranslate"><span class="pre">Table</span></code> class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module1.html">Simulated planetary systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module2.html">Simulated survey datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module3.html">Hypothesis testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../module4.html">Computing statistical power</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial 1: Generating planetary systems</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Setup">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Loading-the-Generator">Loading the Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Running-the-Generator">Running the Generator</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Adding-new-steps">Adding new steps</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="GettingStarted2.html">Tutorial 2: Simulating survey datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example1.html">Example 1: Finding the habitable zone</a></li>
<li class="toctree-l1"><a class="reference internal" href="Example2.html">Example 2: Detecting the age-oxygen correlation</a></li>
</ul>
<p class="caption"><span class="caption-text">Full Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.analysis.html">bioverse.analysis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.classes.html">bioverse.classes module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.constants.html">bioverse.constants module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.custom.html">bioverse.custom module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.functions.html">bioverse.functions module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.generator.html">bioverse.generator module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.hypothesis.html">bioverse.hypothesis module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.plots.html">bioverse.plots module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.survey.html">bioverse.survey module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidoc/bioverse.util.html">bioverse.util module</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Bioverse</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Tutorial 1: Generating planetary systems</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Notebooks/GettingStarted1.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="admonition note">
<b>Note:</b> This example is available as an interactive Jupyter notebook in the file <code>Notebooks/GettingStarted1.ipynb</code>
</div><div class="section" id="Tutorial-1:-Generating-planetary-systems">
<h1>Tutorial 1: Generating planetary systems<a class="headerlink" href="#Tutorial-1:-Generating-planetary-systems" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we will review how to use the Generator class to generate a sample of planetary systems, including how to add or replace steps in the process.</p>
<div class="section" id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Permalink to this headline">¶</a></h2>
<p>Let’s start by importing the necessary module from Bioverse.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Add the directory containing ./bioverse to the system path</span>
<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">topdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;../../../&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">topdir</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>

<span class="c1"># Import the Generator class</span>
<span class="kn">from</span> <span class="nn">bioverse.generator</span> <span class="kn">import</span> <span class="n">Generator</span>

<span class="c1"># Import pyplot (for making plots later) and adjust some of its settings</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">20.</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Loading-the-Generator">
<h2>Loading the Generator<a class="headerlink" href="#Loading-the-Generator" title="Permalink to this headline">¶</a></h2>
<p>The first step in using Bioverse is to generate a simulated sample of planetary systems. This is accomplished with a Generator object, of which two come pre-installed. Let’s open one of them and examine its contents.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Open the transit mode generator and display its properties</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;transit&#39;</span><span class="p">)</span>
<span class="n">generator</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generator with 12 steps:
 0: Function &#39;create_stars_Gaia&#39; with 6 keyword arguments.
 1: Function &#39;create_planets_SAG13&#39; with 9 keyword arguments.
 2: Function &#39;assign_orbital_elements&#39; with 1 keyword arguments.
 3: Function &#39;geometric_albedo&#39; with 2 keyword arguments.
 4: Function &#39;impact_parameter&#39; with 1 keyword arguments.
 5: Function &#39;assign_mass&#39; with no keyword arguments.
 6: Function &#39;compute_habitable_zone_boundaries&#39; with no keyword arguments.
 7: Function &#39;compute_transit_params&#39; with no keyword arguments.
 8: Function &#39;classify_planets&#39; with no keyword arguments.
 9: Function &#39;scale_height&#39; with no keyword arguments.
10: Function &#39;Example1_water&#39; with 3 keyword arguments.
11: Function &#39;Example2_oxygen&#39; with 2 keyword arguments.
</pre></div></div>
</div>
<p>The list above shows each of the steps the Generator runs through in producing the sample of planetary systems. For more information about an individual step, we can display it based on its index:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Show more about the &#39;create_planets_SAG13&#39; step</span>
<span class="n">generator</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Function &#39;create_planets_SAG13&#39; with 9 keyword arguments.

Description:
    Generates planets with periods and radii according to SAG13 occurrence rate estimates, but incorporating
    the dependence of occurrence rates on spectral type from Mulders+2015.

    Parameters
    ----------
    d : Table
        Table containing simulated host stars.
    eta_Earth : float, optional
        The number of Earth-sized planets in the habitable zones of Sun-like stars. All occurrence
        rates are uniformly scaled to produce this estimate.
    R_min : float, optional
        Minimum planet radius, in Earth units.
    R_max : float, optional
        Maximum planet radius, in Earth units.
    P_min : float, optional
        Minimum orbital period, in years.
    P_max : float, optional
        Maximum orbital period, in years.
    normalize_SpT : bool, optional
        If True, modulate occurrence rates by stellar mass according to Mulders+2015. Otherwise, assume no
        dependency on stellar mass.
    transit_mode : bool, optional
        If True, only transiting planets are simulated. Occurrence rates are modified to reflect the R_*/a transit probability.
    optimistic : bool, optional
        If True, extrapolate the results of Mulders+2015 by assuming rocky planets are much more common around late-type M dwarfs. If False,
        assume that occurrence rates plateau with stellar mass for stars cooler than ~M3.
    optimistic_factor : float, optional
        If optimistic = True, defines how many times more common rocky planets are around late-type M dwarfs compared to Sun-like stars.


    Returns
    -------
    d : Table
        Table containing the sample of simulated planets. Replaces the input Table.

Argument values:
    eta_Earth      = 0.075
    R_min          = 0.5
    R_max          = 14.3
    P_min          = 0.01
    P_max          = 10.0
    normalize_SpT  = True
    transit_mode   = True
    optimistic     = False
    optimistic_factor = 5
</pre></div></div>
</div>
<p>Here we see a short description of the planet generation step as well as its keyword arguments, including <code class="docutils literal notranslate"><span class="pre">eta_Earth</span></code>. This specifies the average number of Earth-sized planets in the habitable zones of Sun-like stars, and it is currently set to 7.5% (following Pascucci et al. 2020). Let’s change this to a more optimistic value:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set eta_Earth = 15%</span>
<span class="n">generator</span><span class="o">.</span><span class="n">set_arg</span><span class="p">(</span><span class="s1">&#39;eta_Earth&#39;</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Some arguments are shared by multiple functions - for example, the <code class="docutils literal notranslate"><span class="pre">transit_mode</span></code> argument tells a couple of functions that only transiting planets are being simulated. By default, it is set to <code class="docutils literal notranslate"><span class="pre">False</span></code>, but we can change that like so:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Set transit_mode = True for all functions that use it</span>
<span class="n">generator</span><span class="o">.</span><span class="n">set_arg</span><span class="p">(</span><span class="s1">&#39;transit_mode&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># We can also check on an argument&#39;s value as follows:</span>
<span class="n">val</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">generator</span><span class="o">.</span><span class="n">get_arg</span><span class="p">(</span><span class="s1">&#39;transit_mode&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The current value of transit_mode is </span><span class="si">{:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

The current value of transit_mode is True
</pre></div></div>
</div>
</div>
<div class="section" id="Running-the-Generator">
<h2>Running the Generator<a class="headerlink" href="#Running-the-Generator" title="Permalink to this headline">¶</a></h2>
<p>Now, let’s use this Generator object to produce an ensemble of transiting planets within 100 parsecs.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sample</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">d_max</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Generated a sample of </span><span class="si">{:d}</span><span class="s2"> transiting planets including </span><span class="si">{:d}</span><span class="s2"> exo-Earth candidates.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sample</span><span class="p">),</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;EEC&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generated a sample of 16998 transiting planets including 1121 exo-Earth candidates.
</pre></div></div>
</div>
<p>Let’s plot the period and radius distribution of this planet sample:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="c1"># Period histogram</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Period (d)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of planets&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>

<span class="c1"># Radius histogram</span>
<span class="n">R</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">R</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Radius ($R_\oplus$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of planets&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Notebooks_GettingStarted1_13_0.svg" src="../_images/Notebooks_GettingStarted1_13_0.svg" /></div>
</div>
</div>
<div class="section" id="Adding-new-steps">
<h2>Adding new steps<a class="headerlink" href="#Adding-new-steps" title="Permalink to this headline">¶</a></h2>
<p>Finally, suppose you want to simulate a new planetary property in Bioverse. For example, suppose you want to assign an ocean covering fraction to each planet (<code class="docutils literal notranslate"><span class="pre">f_ocean_min</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">f_ocean</span></code> &lt; <code class="docutils literal notranslate"><span class="pre">f_ocean_max</span></code> for exo-Earth candidates and <code class="docutils literal notranslate"><span class="pre">f_ocean</span></code> = 0 for others). We can accomplish this like so:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Define a function that accepts and returns a Table object</span>
<span class="k">def</span> <span class="nf">oceans</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">f_ocean_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">f_ocean_max</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="c1"># First, assign zero for all planets</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;f_ocean&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

    <span class="c1"># Next, assign a random non-zero value for exo-Earth candidates</span>
    <span class="n">EEC</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;EEC&#39;</span><span class="p">]</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;f_ocean&#39;</span><span class="p">][</span><span class="n">EEC</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">f_ocean_min</span><span class="p">,</span> <span class="n">f_ocean_max</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">EEC</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

    <span class="c1"># Finally, return the Table with its new column</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="c1"># Insert this function at the end of the Generator</span>
<span class="n">generator</span><span class="o">.</span><span class="n">insert_step</span><span class="p">(</span><span class="n">oceans</span><span class="p">)</span>

<span class="c1"># Run the generator with f_ocean_min = 0.3 and f_ocean_max = 0.7</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">d_max</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">f_ocean_min</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">f_ocean_max</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Now, let’s plot the distribution of ocean covering fractions for EECs and non-EECs:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>

<span class="n">f_ocean</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;f_ocean&#39;</span><span class="p">]</span>
<span class="n">EEC</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s1">&#39;EEC&#39;</span><span class="p">]</span>

<span class="c1"># EECs</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_ocean</span><span class="p">[</span><span class="n">EEC</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;exo-Earth candidates&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Number of planets&#39;</span><span class="p">)</span>

<span class="c1"># Non-EECs</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">f_ocean</span><span class="p">[</span><span class="o">~</span><span class="n">EEC</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;non-habitable planets&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/Notebooks_GettingStarted1_17_0.svg" src="../_images/Notebooks_GettingStarted1_17_0.svg" /></div>
</div>
<p>Of course, you may wish to change the <code class="docutils literal notranslate"><span class="pre">oceans</span></code> function later, and it would be tiring to add it to the Generator again each time. Instead, we can point the Generator to a Python file containing your function, which must be saved under <code class="docutils literal notranslate"><span class="pre">bioverse/functions/</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Reload the generator to erase the previously-added step</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;transit&#39;</span><span class="p">)</span>

<span class="c1"># Write the function definition as a string</span>
<span class="n">func</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Define a function that accepts and returns a Table object</span>
<span class="s2">def oceans(d, f_ocean_min=0, f_ocean_max=1):</span>
<span class="s2">    # First, assign zero for all planets</span>
<span class="s2">    d[&#39;f_ocean&#39;] = np.zeros(len(d))</span>

<span class="s2">    # Next, assign a random non-zero value for exo-Earth candidates</span>
<span class="s2">    EEC = d[&#39;EEC&#39;]</span>
<span class="s2">    d[&#39;f_ocean&#39;][EEC] = np.random.uniform(f_ocean_min, f_ocean_max, size=EEC.sum())</span>

<span class="s2">    # Finally, return the Table with its new column</span>
<span class="s2">    return d</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Save the function to a .py file</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">topdir</span><span class="o">+</span><span class="s1">&#39;/bioverse/example_oceans.py&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>

<span class="c1"># Insert this function into the Generator and specify the filename</span>
<span class="n">generator</span><span class="o">.</span><span class="n">insert_step</span><span class="p">(</span><span class="s1">&#39;oceans&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;example_oceans.py&#39;</span><span class="p">)</span>

<span class="c1"># Verify that the new step has been added</span>
<span class="n">generator</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Generator with 13 steps:
 0: Function &#39;create_stars_Gaia&#39; with 6 keyword arguments.
 1: Function &#39;create_planets_SAG13&#39; with 9 keyword arguments.
 2: Function &#39;assign_orbital_elements&#39; with 1 keyword arguments.
 3: Function &#39;geometric_albedo&#39; with 2 keyword arguments.
 4: Function &#39;impact_parameter&#39; with 1 keyword arguments.
 5: Function &#39;assign_mass&#39; with no keyword arguments.
 6: Function &#39;compute_habitable_zone_boundaries&#39; with no keyword arguments.
 7: Function &#39;compute_transit_params&#39; with no keyword arguments.
 8: Function &#39;classify_planets&#39; with no keyword arguments.
 9: Function &#39;scale_height&#39; with no keyword arguments.
10: Function &#39;Example1_water&#39; with 3 keyword arguments.
11: Function &#39;Example2_oxygen&#39; with 2 keyword arguments.
12: Function &#39;oceans&#39; with 2 keyword arguments.
</pre></div></div>
</div>
<p>Now, any changes you make to the <code class="docutils literal notranslate"><span class="pre">oceans</span></code> function under <code class="docutils literal notranslate"><span class="pre">example_oceans.py</span></code> will automatically be applied. Finally, you will want to save this Generator under a new name, so that you don’t have to re-add the new step every time you load Bioverse:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># Save the new Generator</span>
<span class="n">generator</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;transit_oceans&#39;</span><span class="p">)</span>

<span class="c1"># Reload it</span>
<span class="n">generator</span> <span class="o">=</span> <span class="n">Generator</span><span class="p">(</span><span class="s1">&#39;transit_oceans&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The following lines of code will clean up the files created during this exercise:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">trash</span> <span class="o">=</span> <span class="p">[</span><span class="n">topdir</span><span class="o">+</span><span class="s1">&#39;/bioverse/Objects/Generators/transit_oceans.pkl&#39;</span><span class="p">,</span> <span class="n">topdir</span><span class="o">+</span><span class="s1">&#39;/bioverse/example_oceans.py&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">trash</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The next example will translate this simulated sample of planetary systems into a dataset from a transit spectroscopy survey.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="GettingStarted2.html" class="btn btn-neutral float-right" title="Tutorial 2: Simulating survey datasets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../module4.html" class="btn btn-neutral float-left" title="Computing statistical power" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Alex Bixel.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
  
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search {
    display: block;
    width: 300px;
    padding: .809em;
    margin-bottom: .809em;
    z-index: 200;
    background-color: #0b750a;
    text-align: center;
    color: #fcfcfc;
    }
    .wy-nav-top {
      background: #0b750a;
    }
    
    .wy-menu-vertical header, .wy-menu-vertical p.caption {
    color: #0b750a;
    line-height: 32px;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 85%;
    white-space: nowrap;
}

html.writer-html4 .rst-content dl:not(.docutils) > dt, html.writer-html5 .rst-content dl[class]:not(.option-list):not(.field-list):not(.footnote):not(.glossary):not(.simple) > dt {
    display: table;
    margin: 6px 0;
        margin-top: 6px;
    font-size: 90%;
    line-height: normal;
    background: #edffed;
    color: #0b750a;
    border-top: 3px solid #0b750a;
    padding: 6px;
    position: relative;
}

  a {
    color: #0b750a;
    text-decoration: none;
    cursor: pointer;
}

.wy-table-responsive table td, .wy-table-responsive table th {
    white-space: normal;
}

  </style>
  
  
  


</body>
</html>